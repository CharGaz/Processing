/* autogenerated by Processing revision 1293 on 2024-10-30 */
import processing.core.*;
import processing.data.*;
import processing.event.*;
import processing.opengl.*;

import java.util.HashMap;
import java.util.ArrayList;
import java.io.File;
import java.io.BufferedReader;
import java.io.PrintWriter;
import java.io.InputStream;
import java.io.OutputStream;
import java.io.IOException;

public class Processing extends PApplet {


int numPeople = 25; //getting the number of people


PImage skullImage; //setting a variable for skull image

Person[] person = new Person[numPeople]; //making an array for all the people


int sick = color(255,0,0); //Setting colour for each status 
int healthy = color(0,255,0);
int doctor = color(0,0,255);

int[] colours = {sick, healthy, doctor}; //Putting status into a list

public void setup(){
  /* size commented out by preprocessor */;

  for(int i = 0; i < person.length; i++){ //runs for the amount of people in the list 
    float xPos = random(20,width-20);  //The length of the radius away from the borders, the full ball will be in the canvas
    float yPos = random(20,height-20); //random start
    float xVel = random(-5,5); //random speed in the x,y
    float yVel = random(-5,5);


    person[i] = new Person(xPos, yPos, xVel, yVel, 40, colours[PApplet.parseInt(random(colours.length))]); //making a class for each person 
    
  }

  skullImage = loadImage("Skull.jpg"); //loading in the skull image 
}

public void draw(){
  background(0);
  

  for(int i = 0; i < person.length; i++){ //runs for all the people, to draw, update their position and check if they are dead
    person[i].drawMe();
    person[i].updatePos(); 
    person[i].maybeDie();



    for(int j = i+1; j < (person.length); j++){ //runs for each person, not itself, to check for collisions
      person[i].checkCollision(person[j]); 
    }
  }
  fill(255);
  textSize(25);
  text("TIME RUNNING: "+ millis()/1000 +"s", 25,50);
  
}
class Person{
    PVector pos;
    PVector vel;
    int diam;
    int timer;
    int status;
    boolean alive;
    boolean skull;

    //CONSTRUCTOR:
    Person(float x, float y, float xVel, float yVel, int d, int c){
        this.pos = new PVector(x,y);
        this.vel = new PVector(xVel,yVel);
        this.diam = d;
        this.timer = 0;
        this.status = color(c);
        this.alive = true;
        this.skull = false;
    }

    public void drawMe(){
        if(this.alive == true){ //only runs when they are alive
            if(this.skull == false){ //setting the balls with their status
                fill(this.status);
                circle(this.pos.x, this.pos.y, diam);
            }

            else{ //After the infected die, they change into a skull for one second
                image(skullImage, this.pos.x,this.pos.y, 70, 70);
            }
        }


    }

    public void updatePos(){
        if(this.alive == true){ //Only runs if they are alive
            this.pos.add(this.vel);

            if(this.pos.x <= this.diam/2 || this.pos.x >= width-(this.diam/2)){ //If they hit a wall, they bounce
                this.vel.x *= (-1);

                if(this.pos.x < diam/2){ //So they dont get stuck in the wall
                    float dist = diam/2- this.pos.x;
                    this.pos.x += dist;
                }
                if(this.pos.x > width - diam/2){ //So they dont get stuck in the wall
                    float dist  =this.pos.x - (width-diam/2);
                    this.pos.x -= dist;
                }
            }
            
            if(this.pos.y <= this.diam/2 || this.pos.y >= height-(this.diam/2)){ //If they hit a wall, they bounce
                this.vel.y *= (-1);

                if(this.pos.y < diam/2){ //So they dont get stuck in the wall
                    float dist = diam/2  - this.pos.y;
                    this.pos.y += dist;
                }
                if(this.pos.y > height - diam/2){ //So they dont get stuck in the wall
                    float dist = this.pos.y - (height-diam/2);
                    this.pos.y -= dist;
                }

            }


            
        }
    
    }

    public void checkCollision(Person other){
        if((this.status == colours[0] && millis() - this.timer > 5000) || (other.status == colours[0] && millis() - other.timer > 5000)){
            return; //only runs when they have been infected for less then 5 seconds
        }
        if(this.alive == true){ //if they die, they no longer collide
            //checking the collisions between other balls
            PVector collided = new PVector(other.pos.x - this.pos.x, other.pos.y - this.pos.y);

            if(collided.mag() <= this.diam){
                PVector collidedHat = collided.normalize(null);

                float k = this.vel.dot(collidedHat) - other.vel.dot(collidedHat);
                PVector deltaVel = PVector.mult(collidedHat,-k);
                PVector deltaOtherVel = PVector.mult(collidedHat,k);

                if(collided.mag() <= diam){ //So they dont get stuck in eachother 
                    float dis = diam - collided.mag();

                    PVector delPos = PVector.mult(collidedHat, -dis/2);
                    PVector delOtherPos = PVector.mult(collidedHat, dis/2);
                    
                    this.pos.add(delPos);
                    other.pos.add(delOtherPos);
                }

                this.vel.add(deltaVel);
                other.vel.add(deltaOtherVel);

                if(this.skull == false){
                    if(this.status == colours[0] && other.status == colours[1]){ //making healthy people sick
                        other.status = colours[0]; //Turning the colour red
                        other.vel.mult(0.7f); //Slowing the sick
                        other.timer = 0; //setting timer for infection
                    }
                    else if(this.status == colours[1] && other.status == colours[0]){ //making healthy people sick
                        this.status = colours[0]; //Turning the colour red
                        this.vel.mult(0.7f); //Slowing the sick 
                        this.timer = millis(); //setting timer for infection
                    }

                    else if(this.status == colours[0] && other.status == colours[2]){ //making sick people healthy
                        this.status = colours[1]; //Turning the colour green
                        this.vel.mult(1.3f); //Speeding the healthy up
                        this.timer = 0; //resetting timer
                    }
                    else if(this.status == colours[2] && other.status == colours[0]){ //making sick people healthy
                        other.status = colours[1]; //Turning the colour green
                        other.vel.mult(1.3f); //Speeding the healthy up
                        other.timer = 0; //resetting timer
                    }
                }
            }
        }
    }

    public void maybeDie(){
        if(millis()-this.timer > 5000){ //Checks if it has been 5 seconds since ball collided 
            if(this.status == colours[0]){ //Checks to see if they are red/infected
                this.skull = true; //Turns skull to true, so you can see the skull, but it does not infect 

                if(millis()-this.timer > 6000){ //Wait one second before skull disapears 
                    this.alive = false; //Making the skull disapear 
                    
                }

            } 
        }
    }
   
}


  public void settings() { size(1000, 1000); }

  static public void main(String[] passedArgs) {
    String[] appletArgs = new String[] { "Processing" };
    if (passedArgs != null) {
      PApplet.main(concat(appletArgs, passedArgs));
    } else {
      PApplet.main(appletArgs);
    }
  }
}
